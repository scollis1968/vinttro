server {
    listen 80;
    listen [::]:80;
    server_name services.uat.vinttro.co.uk
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name services.uat.vinttro.co.uk;

    # Certbot SSL configuration
    ssl_certificate /etc/letsencrypt/live/services.uat.vinttro.co.uk/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/services.uat.vinttro.co.uk/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    # This is the crucial part that handles the webhook
    location /hooks/deploy-vinttro {
        # The proxy_pass directive forwards the request to the local webhook service.
        # Replace the port (e.g., 8080) and URL with your local service's address.
        proxy_pass http://localhost:9000;
        
        # These headers ensure the original request information is passed on.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Optional: You can add IP whitelisting for security here.
        # This will only allow GitHub's IP addresses to connect.
        # You'll need to find the current list of GitHub's webhook IPs and update this.
        # allow 140.82.112.0/20;
        # deny all;
    }

    # Add other locations as needed, or a default 404
    location / {
        return 404;
    }
}